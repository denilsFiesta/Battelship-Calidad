<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Game.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Battleship-project</a> &gt; <a href="index.source.html" class="el_package">com.model.game</a> &gt; <span class="el_source">Game.java</span></div><h1>Game.java</h1><pre class="source lang-java linenums">package com.model.game;

import com.model.game.ocean.Ocean;
import com.model.game.ocean.Point;
import com.model.game.user.StatusChangedListener;
import com.model.ships.Ship;

import java.util.ArrayList;
import java.util.EnumSet;
import java.util.List;

public class Game {
    private Ocean ocean;
    private int fleetHealth;
    private int availableTorpedo;
    private EnumSet&lt;GameMode&gt; gameMode;

    /**
     * Create new game.
     *
     * @param sizeHorizontal horizontal size of the ocean
     * @param sizeVertical   vertical size of the ocean
     * @throws IllegalArgumentException cannot create ocean with this parameters
     */
<span class="nc" id="L25">    public Game(int sizeHorizontal, int sizeVertical) throws IllegalArgumentException {</span>
<span class="nc" id="L26">        ocean = new Ocean(sizeHorizontal, sizeVertical);</span>
<span class="nc" id="L27">    }</span>

    /**
     * Set the game mode.
     *
     * @param mode           enum set of options
     * @param torpedoCounter torpedo counter
     * @throws IllegalArgumentException when torpedo counter mismatching with game mode
     */
    public void setGameMode(EnumSet&lt;GameMode&gt; mode, int torpedoCounter) throws IllegalArgumentException {
        // if mode == null: game without torpedo mode and recovery mode.
<span class="nc" id="L38">        gameMode = mode;</span>

<span class="nc bnc" id="L40" title="All 4 branches missed.">        if (!gameMode.contains(GameMode.TORPEDO_MODE_ENABLE) &amp;&amp; torpedoCounter &gt; 0) {</span>
<span class="nc" id="L41">            throw new IllegalArgumentException(&quot;ERROR: Game mode isn't TORPEDO_MODE_ENABLE, but torpedoCounter = &quot; + torpedoCounter);</span>
        }

<span class="nc bnc" id="L44" title="All 2 branches missed.">        if (gameMode.contains(GameMode.TORPEDO_MODE_ENABLE)) {</span>
<span class="nc bnc" id="L45" title="All 2 branches missed.">            if (torpedoCounter &lt;= 0) {</span>
<span class="nc" id="L46">                throw new IllegalArgumentException(&quot;ERROR: Game mode is TORPEDO_MODE_ENABLE, but torpedoCounter = &quot; + torpedoCounter);</span>
            }
<span class="nc" id="L48">            availableTorpedo = torpedoCounter;</span>
        } else {
<span class="nc" id="L50">            availableTorpedo = 0;</span>
        }
<span class="nc" id="L52">    }</span>

    /**
     * @param torpedoCounter number of available torpedo
     * @param recoveryMode   recovery mode turned on/off
     * @return Game mode
     */
    public static EnumSet&lt;GameMode&gt; recognizeMode(int torpedoCounter, boolean recoveryMode) {
<span class="nc bnc" id="L60" title="All 4 branches missed.">        if (torpedoCounter &gt; 0 &amp;&amp; recoveryMode) return GameMode.All_OPTIONS;</span>
<span class="nc bnc" id="L61" title="All 2 branches missed.">        if (torpedoCounter &gt; 0) return EnumSet.of(GameMode.TORPEDO_MODE_ENABLE);</span>
<span class="nc bnc" id="L62" title="All 2 branches missed.">        if (recoveryMode) return EnumSet.of(GameMode.SHIP_RECOVERY_MODE_ENABLE);</span>
<span class="nc" id="L63">        else return EnumSet.of(GameMode.NO_OPTIONS);</span>
    }

    /**
     * Placing ship on the Ocean.
     *
     * @param counters array of numbers, where these numbers are listed in the order
     *                 which corresponds to ship types sizes
     * @throws RuntimeException if ocean size is too small for the input specified fleet
     */
    public void placeShipsOnOcean(int[] counters) throws RuntimeException {
<span class="nc" id="L74">        List&lt;Ship&gt; ships = Ship.convertInputIntegersToShips(counters);</span>
<span class="nc" id="L75">        fleetHealth = ships.stream().mapToInt(Ship::getLength).sum();</span>

        // Fleet size bigger than ocean size
<span class="nc bnc" id="L78" title="All 2 branches missed.">        if (ocean.getSizeVertical() * ocean.getSizeHorizontal() &lt;= fleetHealth)</span>
<span class="nc" id="L79">            throw new RuntimeException(&quot;Cannot place ships on this ocean&quot;);</span>
<span class="nc" id="L80">        this.ocean = Ocean.randomPlace(ships, ocean);</span>

<span class="nc bnc" id="L82" title="All 2 branches missed.">        if (ocean == null)</span>
<span class="nc" id="L83">            throw new RuntimeException(&quot;Cannot place ships on this ocean&quot;);</span>
<span class="nc" id="L84">    }</span>

<span class="nc" id="L86">    private final List&lt;StatusChangedListener&gt; listeners = new ArrayList&lt;&gt;();</span>

    /**
     * (Only for recovery mode) Subscribes listener to user status changed event.
     *
     * @param user user to subscribe.
     */
    public void addListener(StatusChangedListener user) {
<span class="nc" id="L94">        listeners.add(user);</span>
<span class="nc" id="L95">    }</span>

    /**
     * Notify everybody in listeners list.
     *
     * @param report report of current attack
     */
    private void changeStatus(AttackReport report) {
<span class="nc bnc" id="L103" title="All 2 branches missed.">        for (StatusChangedListener user : listeners)</span>
<span class="nc" id="L104">            user.onStatusChanged(report);</span>
<span class="nc" id="L105">    }</span>

    /**
     * Attack on specified point on ocean.
     *
     * @param point      point to attack
     * @param firingMode general / torpedo
     * @return attack report
     * @throws IllegalArgumentException if firing mode = torpedo and there is no available torpedo
     */
    public AttackReport hitOnPlace(Point point, FiringMode firingMode) throws IllegalArgumentException {
<span class="nc bnc" id="L116" title="All 4 branches missed.">        if (firingMode == FiringMode.TORPEDO_FIRING_MODE &amp;&amp; availableTorpedo &lt;= 0) {</span>
<span class="nc" id="L117">            throw new IllegalArgumentException(&quot;No torpedoes available&quot;);</span>
        }
<span class="nc bnc" id="L119" title="All 2 branches missed.">        if (firingMode == FiringMode.TORPEDO_FIRING_MODE) --availableTorpedo;</span>

        AttackReport report;
<span class="nc bnc" id="L122" title="All 2 branches missed.">        if (!ocean.isEmpty(point)) {</span>
<span class="nc" id="L123">            Ship attackingShip = ocean.getShipByPosition(point);</span>
<span class="nc" id="L124">            HealthReport healthReport = attackingShip.hitTheShip(firingMode);</span>

            // Recalculating fleet health and torpedo available.
<span class="nc" id="L127">            fleetHealth -= healthReport.scoreByHit();</span>
<span class="nc" id="L128">            AttackReport.HitResult result = AttackReport.getResult(healthReport.healthRemaining());</span>

            // update if was sunk
<span class="nc bnc" id="L131" title="All 2 branches missed.">            if (result == AttackReport.HitResult.SUNK) {</span>
<span class="nc" id="L132">                var pointsOccupiedByShip = ocean.getPointsOccupiedByShip(attackingShip);</span>
<span class="nc" id="L133">                report = new AttackReport(attackingShip, result, point, fleetHealth, pointsOccupiedByShip);</span>
<span class="nc" id="L134">            } else {</span>
<span class="nc" id="L135">                report = new AttackReport(attackingShip, result, point, fleetHealth, null);</span>
            }
<span class="nc" id="L137">        } else {</span>
<span class="nc" id="L138">            report = new AttackReport(null, AttackReport.getMissedResult(), point, fleetHealth, null);</span>
        }

<span class="nc bnc" id="L141" title="All 2 branches missed.">        if (gameMode.contains(GameMode.SHIP_RECOVERY_MODE_ENABLE)) {</span>
            // notify that status has been changed
<span class="nc" id="L143">            changeStatus(report);</span>
        }
<span class="nc" id="L145">        return report;</span>
    }

    /**
     * Only for ship recovery mode.
     */
    private List&lt;Point&gt; pointsToRecover;

    /**
     * Restore fleet health. (only for ship recovery mode).
     *
     * @param healthScoresToAdd health scores to add
     */
    public void restorePreviousHealthFleet(int healthScoresToAdd) {
<span class="nc" id="L159">        fleetHealth += healthScoresToAdd;</span>
<span class="nc" id="L160">    }</span>

    /**
     * Update list of points to recover (only for ship recovery mode).
     *
     * @param points list of points
     */
    public void updatePointsToRecover(List&lt;Point&gt; points) {
<span class="nc" id="L168">        pointsToRecover = points;</span>
<span class="nc" id="L169">    }</span>

    /**
     * (only for ship recovery mode)
     *
     * @return list of points to recover
     */
    public List&lt;Point&gt; getPointsToRecover() {
<span class="nc" id="L177">        return pointsToRecover;</span>
    }

    /**
     * (only for ship recovery mode)
     * Clear list.
     */
    public void clearPointsToRecover() {
<span class="nc" id="L185">        pointsToRecover.clear();</span>
<span class="nc" id="L186">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>